<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR Business Card</title>
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }
        #ar-scene {
            width: 100vw;
            height: 100vh;
        }
        #quiz-container {
            background: white;
            padding: 0.1em;
            border-radius: 0.05em;
            display: none;
            flex-direction: column;
            align-items: center;
            pointer-events: auto;
            font-size: 0.05em;
            width: 0.8em;
            text-align: center;
        }
        #quiz-question {
            font-size: 0.05em;
            margin-bottom: 0.05em;
        }
        #quiz-options {
            display: flex;
            flex-direction: column;
            gap: 0.05em;
        }
        .quiz-option {
            padding: 0.05em;
            background: lightblue;
            cursor: pointer;
            border-radius: 0.025em;
        }
        #quiz-feedback {
            margin-top: 0.05em;
            font-weight: bold;
        }
        #finish-button {
            margin-top: 0.1em;
            padding: 0.05em 0.1em;
            background: green;
            color: white;
            border: none;
            border-radius: 0.025em;
            cursor: pointer;
            display: none;
        }
    </style>
</head>
<body>
    <a-scene mindar-image="imageTargetSrc: ./targets/mycard.mind; autoStart: false; uiLoading: no; uiError: no; uiScanning: no;" embedded color-space="sRGB" renderer="colorManagement: true, physicallyCorrectLights" vr-mode-ui="enabled: false" device-orientation-permission-ui="enabled: false" id="ar-scene">
        <a-assets>
            <img id="main-photo" src="./images/photo.jpg">
            <video id="main-video" src="./video/lesa.mp4" loop="false" preload="auto"></video>
            <img id="icon-googlesites" src="./icons/googlesites.png">
            <img id="icon-goy" src="./icons/goy.png">
            <img id="icon-instagram" src="./icons/instagram.png">
            <img id="icon-play" src="./icons/play.png">
            <img id="icon-telegram" src="./icons/telegram.png">
            <img id="icon-youtube" src="./icons/youtube.png">
        </a-assets>

        <a-camera position="0 0 0" look-controls="enabled: false" cursor="fuse: false; rayOrigin: mouse;" raycaster="far: 10000; objects: .clickable"></a-camera>

        <a-entity mindar-image-target="targetIndex: 0">
            <!-- Main photo plane -->
            <a-plane src="#main-photo" position="0 0 0" height="1" width="1" rotation="0 0 0" class="clickable" id="main-plane"></a-plane>

            <!-- Video entity, initially hidden to the left -->
            <a-video src="#main-video" position="-1.5 0 0" height="0.8" width="1.42" rotation="0 0 0" visible="false" id="slide-video"></a-video>

            <!-- Game button, initially hidden to the right -->
            <a-plane src="#icon-play" position="1.5 0 0" height="0.2" width="0.2" rotation="0 0 0" visible="false" class="clickable" id="game-button"></a-plane>

            <!-- Social media buttons, initially hidden -->
            <a-plane src="#icon-googlesites" position="-0.4 -0.6 0" height="0.1" width="0.1" rotation="0 0 0" class="clickable" id="googlesites-button" visible="false"></a-plane>
            <a-plane src="#icon-goy" position="-0.2 -0.6 0" height="0.1" width="0.1" rotation="0 0 0" class="clickable" id="goy-button" visible="false"></a-plane>
            <a-plane src="#icon-instagram" position="0 -0.6 0" height="0.1" width="0.1" rotation="0 0 0" class="clickable" id="instagram-button" visible="false"></a-plane>
            <a-plane src="#icon-telegram" position="0.2 -0.6 0" height="0.1" width="0.1" rotation="0 0 0" class="clickable" id="telegram-button" visible="false"></a-plane>
            <a-plane src="#icon-youtube" position="0.4 -0.6 0" height="0.1" width="0.1" rotation="0 0 0" class="clickable" id="youtube-button" visible="false"></a-plane>

            <!-- Quiz container as an HTML entity in AR -->
            <a-entity id="quiz-entity" position="0 0.5 0" scale="1 1 1" visible="false">
                <a-entity geometry="primitive: plane; width: 0.8; height: 0.6" material="color: white; opacity: 0.9" position="0 0 0"></a-entity>
                <a-entity id="quiz-container" position="0 0 0.01" html="#quiz-template"></a-entity>
            </a-entity>
        </a-entity>

        <!-- Quiz HTML template -->
        <template id="quiz-template">
            <div id="quiz-container">
                <div id="quiz-question"></div>
                <div id="quiz-options"></div>
                <div id="quiz-feedback"></div>
                <button id="finish-button" onclick="hideQuiz()">Завершити</button>
            </div>
        </template>
    </a-scene>

    <script>
        // Register A-Frame component for HTML rendering
        AFRAME.registerComponent('html', {
            schema: {
                default: ''
            },
            init: function () {
                this.update();
            },
            update: function () {
                const templateId = this.data;
                const template = document.querySelector(templateId);
                if (template) {
                    this.el.innerHTML = template.innerHTML;
                }
            }
        });

        const scene = document.querySelector('a-scene');
        const mainPlane = document.querySelector('#main-plane');
        const slideVideo = document.querySelector('#slide-video');
        const gameButton = document.querySelector('#game-button');
        const videoElement = document.querySelector('#main-video');
        const quizEntity = document.querySelector('#quiz-entity');
        const quizContainer = document.querySelector('#quiz-container');
        const quizQuestion = document.querySelector('#quiz-question');
        const quizOptions = document.querySelector('#quiz-options');
        const quizFeedback = document.querySelector('#quiz-feedback');
        const finishButton = document.querySelector('#finish-button');

        // Social media buttons
        const socialButtons = {
            'googlesites-button': 'https://sites.google.com/view/your-site',
            'goy-button': 'https://example.com/goy',
            'instagram-button': 'https://instagram.com/your-profile',
            'telegram-button': 'https://t.me/your-channel',
            'youtube-button': 'https://youtube.com/your-channel'
        };

        // Handle clicks on social buttons
        Object.keys(socialButtons).forEach(id => {
            const button = document.querySelector(`#${id}`);
            button.addEventListener('click', () => {
                window.open(socialButtons[id], '_blank');
            });
        });

        // Detect AR target and show elements
        scene.addEventListener('targetFound', event => {
            slideVideo.setAttribute('visible', true);
            slideVideo.setAttribute('animation', 'property: position; to: -0.75 0 0; dur: 1000; easing: easeInOutQuad');
            videoElement.play();

            gameButton.setAttribute('visible', true);
            gameButton.setAttribute('animation', 'property: position; to: 0.75 0 0; dur: 1000; easing: easeInOutQuad');

            // Show social buttons
            Object.keys(socialButtons).forEach(id => {
                const button = document.querySelector(`#${id}`);
                button.setAttribute('visible', true);
            });
        });

        scene.addEventListener('targetLost', event => {
            slideVideo.setAttribute('visible', false);
            slideVideo.setAttribute('position', '-1.5 0 0');
            videoElement.pause();

            gameButton.setAttribute('visible', false);
            gameButton.setAttribute('position', '1.5 0 0');

            // Hide social buttons
            Object.keys(socialButtons).forEach(id => {
                const button = document.querySelector(`#${id}`);
                button.setAttribute('visible', false);
            });

            hideQuiz();
        });

        // Click on main plane - no action or perhaps toggle something
        mainPlane.addEventListener('click', () => {
            // Optional: Toggle video or something
        });

        // Click on game button to start quiz
        gameButton.addEventListener('click', () => {
            startQuiz();
        });

        // Quiz logic
        const questions = [
            {
                question: "Яка столиця України?",
                options: ["Київ", "Львів", "Одеса", "Харків"],
                answer: "Київ"
            },
            {
                question: "Які кольори на прапорі України?",
                options: ["Синій і жовтий", "Червоний і білий", "Зелений і жовтий", "Синій і білий"],
                answer: "Синій і жовтий"
            },
            {
                question: "Яка найбільша річка в Україні?",
                options: ["Дніпро", "Дунай", "Дністер", "Буг"],
                answer: "Дніпро"
            },
            {
                question: "Хто автор 'Кобзаря'?",
                options: ["Тарас Шевченко", "Іван Франко", "Леся Українка", "Михайло Коцюбинський"],
                answer: "Тарас Шевченко"
            },
            {
                question: "Яке море омиває Україну на півдні?",
                options: ["Чорне море", "Балтійське море", "Середземне море", "Каспійське море"],
                answer: "Чорне море"
            }
        ];

        let currentQuestion = 0;
        let score = 0;

        function startQuiz() {
            currentQuestion = 0;
            score = 0;
            quizEntity.setAttribute('visible', true);
            quizContainer.style.display = 'flex';
            finishButton.style.display = 'none';
            loadQuestion();
        }

        function loadQuestion() {
            if (currentQuestion < questions.length) {
                quizQuestion.textContent = questions[currentQuestion].question;
                quizOptions.innerHTML = '';
                questions[currentQuestion].options.forEach(option => {
                    const btn = document.createElement('div');
                    btn.classList.add('quiz-option');
                    btn.textContent = option;
                    btn.onclick = () => checkAnswer(option);
                    quizOptions.appendChild(btn);
                });
                quizFeedback.textContent = '';
            } else {
                quizQuestion.textContent = `Гра завершена! Твій рахунок: ${score}/${questions.length}`;
                quizOptions.innerHTML = '';
                quizFeedback.textContent = '';
                finishButton.style.display = 'block';
            }
        }

        function checkAnswer(selected) {
            const correct = questions[currentQuestion].answer;
            if (selected === correct) {
                score++;
                quizFeedback.textContent = 'Правильно!';
                quizFeedback.style.color = 'green';
            } else {
                quizFeedback.textContent = `Неправильно! Правильна відповідь: ${correct}`;
                quizFeedback.style.color = 'red';
            }
            setTimeout(() => {
                currentQuestion++;
                loadQuestion();
            }, 2000);
        }

        function hideQuiz() {
            quizEntity.setAttribute('visible', false);
            quizContainer.style.display = 'none';
        }
    </script>
</body>
</html>
