<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.2/dist/mindar-image-aframe.prod.js"></script>
  <style>
    body { margin: 0; overflow: hidden; }
    .arjs-loader {
      height: 100%; width: 100%; position: absolute; top: 0; left: 0;
      background: rgba(135, 206, 235, 0.2); z-index: 9999; display: flex;
      justify-content: center; align-items: center; color: #FF4500; font-size: 1.5em;
    }
  </style>

  <script>
    // Компонент для гри-вікторини
    AFRAME.registerComponent('quiz-game', {
      init: function () {
        this.questions = [
          { q: 'Найвища гора України — це?', a: ['Петрос', 'Говерла', 'Піп Іван'], correct: 1 },
          { q: 'Скільки адміністративних областей має Україна?', a: ['22', '24', '25'], correct: 1 },
          { q: 'Яка річка України найдовша?', a: ['Дніпро', 'Дунай', 'Південний Буг'], correct: 0 },
          { q: 'Яка країна межує з Україною на півночі?', a: ['Польща', 'Білорусь', 'Румунія'], correct: 1 },
          { q: 'Скільки морів омиває Україну?', a: ['Одне', 'Два', 'Три'], correct: 1 }
        ];

        this.currentQ = 0;
        this.score = 0;

        let el = this.el;
        let canvas = document.createElement('canvas');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        el.setAttribute('material', `src: ${canvas.toDataURL()}`);
        this.ctx = canvas.getContext('2d');
        this.drawQuiz();

        el.addEventListener('click', (evt) => {
          let uv = evt.detail.uv;
          if (uv && uv.y > 0.4 && uv.y < 0.65) {
            let choice = Math.floor(uv.x * 3);
            this.checkAnswer(choice);
          }
        });
      },
      drawQuiz: function () {
        let ctx = this.ctx;
        let w = ctx.canvas.width, h = ctx.canvas.height;
        ctx.fillStyle = '#111';
        ctx.fillRect(0, 0, w, h);
        ctx.fillStyle = '#fff';
        ctx.textAlign = 'center';
        ctx.font = '50px Arial';
        
        let q = this.questions[this.currentQ];
        if (!q) {
          ctx.fillText(`Вікторина завершена!`, w / 2, h * 0.1);
          ctx.fillText(`Ваш результат: ${this.score} з 5`, w / 2, h * 0.2);
          return;
        }

        ctx.fillText(`Питання ${this.currentQ + 1} з 5`, w / 2, h * 0.08);
        ctx.fillText(q.q, w / 2, h * 0.18);

        ctx.fillStyle = '#555';
        ctx.fillRect(w * 0.05, h * 0.4, w * 0.28, h * 0.1);
        ctx.fillRect(w * 0.37, h * 0.4, w * 0.28, h * 0.1);
        ctx.fillRect(w * 0.69, h * 0.4, w * 0.28, h * 0.1);
        
        ctx.fillStyle = '#fff';
        ctx.font = '30px Arial';
        ctx.fillText(q.a[0], w * 0.19, h * 0.45);
        ctx.fillText(q.a[1], w * 0.51, h * 0.45);
        ctx.fillText(q.a[2], w * 0.83, h * 0.45);
      },
      checkAnswer: function (choice) {
        if (choice === this.questions[this.currentQ].correct) this.score++;
        this.currentQ++;
        setTimeout(() => {
          this.drawQuiz();
          this.el.setAttribute('material', `src: ${this.ctx.canvas.toDataURL()}`);
        }, 500);
      }
    });
  </script>
</head>

<body>
  <div class="arjs-loader" id="loader">Наведи камеру на маркер!</div>
  <a-scene mindar-image="imageTargetSrc: https://lessa2332.github.io/my-ar-vizytka/assets/targets/mycard.mind; autoStart: true; maxTrack: 1"
           color-space="sRGB" renderer="colorManagement: true, physicallyCorrectLights: true"
           vr-mode-ui="enabled: false" device-orientation-permission-ui="enabled: false">
    
    <a-camera position="0 0 0" look-controls="enabled: false" cursor="rayOrigin: mouse" raycaster="objects: .interactive"></a-camera>

    <a-entity mindar-image-target="targetIndex: 0">
      <a-sphere position="0 0 0" radius="0.5" material="src: https://lessa2332.github.io/my-ar-vizytka/assets/images/photo.jpg; side: double; shader: flat"
                animation="property: rotation; to: 0 360 0; loop: true; dur: 20000; easing: linear;"></a-sphere>

      <a-plane position="0 0 0.5" height="1.5" width="1.5" material="color: #00ffcc; opacity: 0.1; shader: flat"
               animation="property: position; from: 0 0.7 0; to: 0 -0.7 0; loop: true; dur: 2000; direction: alternate"></a-plane>

      <a-entity rotation="0 0 0" animation="property: rotation; to: 0 360 0; loop: true; dur: 15000">
        <a-sphere class="interactive" position="0.8 0 0" radius="0.15" material="src: https://lessa2332.github.io/my-ar-vizytka/assets/icons/play.png"
                  onclick="document.getElementById('video-modal').emit('show-modal');"></a-sphere>
        <a-text value="Відео" align="center" width="2" position="0.8 0.25 0" color="#fff" rotation="0 90 0"></a-text>

        <a-sphere class="interactive" position="0 -0.8 0" radius="0.15" material="src: https://lessa2332.github.io/my-ar-vizytka/assets/icons/goy.png"
                  onclick="document.getElementById('game-modal').emit('show-modal');"></a-sphere>
        <a-text value="Гра" align="center" width="2" position="0 -0.55 0" color="#fff" rotation="0 90 0"></a-text>

        <a-sphere class="interactive" position="-0.8 0 0" radius="0.15" material="src: https://lessa2332.github.io/my-ar-vizytka/assets/icons/youtube.png"
                  onclick="document.getElementById('social-modal').emit('show-modal');"></a-sphere>
        <a-text value="Соцмережі" align="center" width="2" position="-0.8 0.25 0" color="#fff" rotation="0 90 0"></a-text>
      </a-entity>

      <a-entity id="video-modal" visible="false" position="0 0 0"
                animation__show="property: position; to: 0 0 1; dur: 500; easing: easeOutQuad; startEvents: show-modal"
                animation__hide="property: position; to: 0 0 0; dur: 500; easing: easeOutQuad; startEvents: hide-modal">
        <a-plane position="0 0 0" height="1" width="1.6" rotation="0 0 0" color="#333" opacity="0.9">
          <a-video src="https://lessa2332.github.io/my-ar-vizytka/assets/video/lesa.mp4" autoplay="true" loop="true" muted="true" position="0 0 0.001" height="0.8" width="1.4"></a-video>
          <a-plane class="interactive" position="0.7 -0.55 0.001" height="0.2" width="0.3" color="#FF0000" onclick="document.getElementById('video-modal').emit('hide-modal');">
            <a-text value="Закрити" align="center" color="#fff" width="1.5" position="0 0 0.01"></a-text>
          </a-plane>
        </a-plane>
      </a-entity>

      <a-entity id="game-modal" visible="false" position="0 0 0"
                animation__show="property: position; to: 0 0 1; dur: 500; easing: easeOutQuad; startEvents: show-modal"
                animation__hide="property: position; to: 0 0 0; dur: 500; easing: easeOutQuad; startEvents: hide-modal">
        <a-plane quiz-game height="1.2" width="1.6" position="0 0 0" rotation="0 0 0" material="side: double"></a-plane>
        <a-plane class="interactive" position="0.7 -0.55 0.001" height="0.2" width="0.3" color="#FF0000" onclick="document.getElementById('game-modal').emit('hide-modal');">
          <a-text value="Закрити" align="center" color="#fff" width="1.5" position="0 0 0.01"></a-text>
        </a-plane>
      </a-entity>

      <a-entity id="social-modal" visible="false" position="0 0 0"
                animation__show="property: position; to: 0 0 1; dur: 500; easing: easeOutQuad; startEvents: show-modal"
                animation__hide="property: position; to: 0 0 0; dur: 500; easing: easeOutQuad; startEvents: hide-modal">
        <a-plane position="0 0 0" height="1.2" width="1.6" color="#333" opacity="0.9">
          <a-text value="Соцмережі:" align="left" color="#fff" width="1.5" position="-0.7 0.45 0.01"></a-text>
          <a-plane class="interactive" position="-0.4 0.25 0.01" height="0.2" width="1" material="src: https://lessa2332.github.io/my-ar-vizytka/assets/icons/youtube.png" onclick="window.open('https://www.youtube.com/@23SmartLessa32', '_blank');"></a-plane>
          <a-plane class="interactive" position="-0.4 0.05 0.01" height="0.2" width="1" material="src: https://lessa2332.github.io/my-ar-vizytka/assets/icons/telegram.png" onclick="window.open('https://t.me/+Ck0ua_cmlI84Yjcy', '_blank');"></a-plane>
          <a-plane class="interactive" position="-0.4 -0.15 0.01" height="0.2" width="1" material="src: https://lessa2332.github.io/my-ar-vizytka/assets/icons/googlesites.png" onclick="window.open('https://sites.google.com/view/questaria/%D0%B3%D0%BE%D0%BB%D0%BE%D0%B2%D0%BD%D0%B0', '_blank');"></a-plane>
          <a-plane class="interactive" position="-0.4 -0.35 0.01" height="0.2" width="1" material="src: https://lessa2332.github.io/my-ar-vizytka/assets/icons/instagram.png" onclick="window.open('https://www.instagram.com/smart23lessa?igsh=aHN5dzZudnJneW85', '_blank');"></a-plane>
          <a-plane class="interactive" position="0.7 -0.55 0.001" height="0.2" width="0.3" color="#FF0000" onclick="document.getElementById('social-modal').emit('hide-modal');">
            <a-text value="Закрити" align="center" color="#fff" width="1.5" position="0 0 0.01"></a-text>
          </a-plane>
        </a-plane>
      </a-entity>
    </a-entity>
  </a-scene>

  <script>
    const loader = document.querySelector('#loader');
    const targetEntity = document.querySelector('[mindar-image-target]');
    const planet = document.querySelector('a-sphere');

    targetEntity.addEventListener('targetFound', () => {
      console.log('Маркер знайдено!');
      loader.style.display = 'none';
      planet.setAttribute('visible', 'true');
    });

    targetEntity.addEventListener('targetLost', () => {
      console.log('Маркер втрачено!');
      loader.style.display = 'flex';
      planet.setAttribute('visible', 'false');
    });
  </script>
</body>
</html>

