<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.2/dist/mindar-image-aframe.prod.js"></script>
    <style>
        body { margin: 0; overflow: hidden; }
        .arjs-loader {
            height: 100%; width: 100%; position: absolute; top: 0; left: 0;
            background: rgba(135, 206, 235, 0.2); z-index: 9999; display: flex;
            justify-content: center; align-items: center; color: #FF4500; font-size: 1.5em;
        }
        @font-face {
            font-family: 'exo2bold';
            src: url('https://lessa2332.github.io/my-ar-vizytka/assets/fonts/Exo2-Bold.ttf') format('truetype');
        }
    </style>

    <script>
        AFRAME.registerComponent('quiz-game', {
            init: function () {
                this.questions = [
                    { q: '–ù–∞–π–≤–∏—â–∞ –≥–æ—Ä–∞ –£–∫—Ä–∞—ó–Ω–∏ ‚Äî —Ü–µ?', a: ['–ü–µ—Ç—Ä–æ—Å', '–ì–æ–≤–µ—Ä–ª–∞', '–ü—ñ–ø –Ü–≤–∞–Ω'], correct: 1 },
                    { q: '–°–∫—ñ–ª—å–∫–∏ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∏—Ö –æ–±–ª–∞—Å—Ç–µ–π –º–∞—î –£–∫—Ä–∞—ó–Ω–∞?', a: ['22', '24', '25'], correct: 1 },
                    { q: '–Ø–∫–∞ —Ä—ñ—á–∫–∞ –£–∫—Ä–∞—ó–Ω–∏ –Ω–∞–π–¥–æ–≤—à–∞?', a: ['–î–Ω—ñ–ø—Ä–æ', '–î—É–Ω–∞–π', '–ü—ñ–≤–¥–µ–Ω–Ω–∏–π –ë—É–≥'], correct: 0 },
                    { q: '–Ø–∫–∞ –∫—Ä–∞—ó–Ω–∞ –º–µ–∂—É—î –∑ –£–∫—Ä–∞—ó–Ω–æ—é –Ω–∞ –ø—ñ–≤–Ω–æ—á—ñ?', a: ['–ü–æ–ª—å—â–∞', '–ë—ñ–ª–æ—Ä—É—Å—å', '–†—É–º—É–Ω—ñ—è'], correct: 1 },
                    { q: '–°–∫—ñ–ª—å–∫–∏ –º–æ—Ä—ñ–≤ –æ–º–∏–≤–∞—î –£–∫—Ä–∞—ó–Ω—É?', a: ['–û–¥–Ω–µ', '–î–≤–∞', '–¢—Ä–∏'], correct: 1 }
                ];
                this.currentQ = 0;
                this.score = 0;
                this.timer = null;
                this.canvas = document.createElement('canvas');
                this.canvas.width = 512; // –ó–º–µ–Ω—à–µ–Ω–∏–π —Ä–æ–∑–º—ñ—Ä –¥–ª—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ
                this.canvas.height = 384;
                this.ctx = this.canvas.getContext('2d');
                this.texture = new THREE.CanvasTexture(this.canvas);
                this.el.setAttribute('material', { src: this.texture, side: 'double' });
                this.drawQuiz();
                this.el.addEventListener('click', (evt) => {
                    if (!evt.detail.uv) {
                        console.warn('UV-–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ñ');
                        return;
                    }
                    let uv = evt.detail.uv;
                    if (uv.y > 0.4 && uv.y < 0.65) {
                        let choice = Math.floor(uv.x * 3);
                        this.checkAnswer(choice);
                    }
                });
            },
            drawQuiz: function () {
                let ctx = this.ctx;
                let w = ctx.canvas.width, h = ctx.canvas.height;
                ctx.fillStyle = '#111';
                ctx.fillRect(0, 0, w, h);
                ctx.fillStyle = '#fff';
                ctx.textAlign = 'center';
                ctx.font = `${Math.min(w * 0.05, 40)}px Arial`;
                let q = this.questions[this.currentQ];
                if (!q) {
                    ctx.fillText(`üéâ –í—ñ–∫—Ç–æ—Ä–∏–Ω–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!`, w / 2, h * 0.1);
                    ctx.fillText(`‚úÖ –í–∞—à —Ä–µ–∑—É–ª—å—Ç–∞—Ç: ${this.score} –∑ 5`, w / 2, h * 0.2);
                    this.texture.needsUpdate = true;
                    return;
                }
                ctx.fillText(`‚ùì –ü–∏—Ç–∞–Ω–Ω—è ${this.currentQ + 1} –∑ 5`, w / 2, h * 0.08);
                ctx.fillText(q.q, w / 2, h * 0.18);
                ctx.fillStyle = '#555';
                ctx.fillRect(w * 0.05, h * 0.4, w * 0.28, h * 0.1);
                ctx.fillRect(w * 0.37, h * 0.4, w * 0.28, h * 0.1);
                ctx.fillRect(w * 0.69, h * 0.4, w * 0.28, h * 0.1);
                ctx.fillStyle = '#fff';
                ctx.font = `${Math.min(w * 0.035, 25)}px Arial`;
                ctx.fillText(q.a[0], w * 0.19, h * 0.45);
                ctx.fillText(q.a[1], w * 0.51, h * 0.45);
                ctx.fillText(q.a[2], w * 0.83, h * 0.45);
                this.texture.needsUpdate = true;
            },
            checkAnswer: function (choice) {
                if (choice === this.questions[this.currentQ].correct) this.score++;
                this.currentQ++;
                clearTimeout(this.timer);
                this.timer = setTimeout(() => {
                    this.drawQuiz();
                }, 500);
            },
            remove: function () {
                clearTimeout(this.timer);
            }
        });
    </script>
</head>

<body>
    <div class="arjs-loader" id="loader">üîç –ù–∞–≤–µ–¥—ñ—Ç—å –∫–∞–º–µ—Ä—É –Ω–∞ –≤—ñ–∑–∏—Ç–∫—É</div>
    <a-scene mindar-image="imageTargetSrc: https://lessa2332.github.io/my-ar-vizytka/assets/targets/mycard.mind; autoStart: true; maxTrack: 1"
        color-space="sRGB" renderer="colorManagement: true, physicallyCorrectLights: true"
        vr-mode-ui="enabled: false" device-orientation-permission-ui="enabled: false">
        
        <a-camera position="0 0 0" look-controls="enabled: false" cursor="rayOrigin: mouse" raycaster="objects: .interactive"></a-camera>

        <a-entity mindar-image-target="targetIndex: 0">
            
            <a-plane id="main-photo-plane" position="0 0 0" height="1" width="1" 
                material="src: https://lessa2332.github.io/my-ar-vizytka/assets/images/photo.jpg" 
                visible="false">
                <a-animation attribute="scale" from="0 0 0" to="1 1 1" dur="1000" easing="ease-in-out" begin="start-ar"></a-animation>
            </a-plane>

            <a-plane id="portal" position="0 0 0.05" height="0.3" width="0.3" 
                material="color: #00ffcc; opacity: 0.5" 
                visible="false">
                <a-animation attribute="scale" from="0 0 0" to="1 1 1" dur="500" easing="ease-in-out" begin="start-ar"></a-animation>
                <a-animation attribute="scale" from="1 1 1" to="1.1 1.1 1.1" dur="1500" direction="alternate" loop="true" easing="ease-in-out" begin="pulse-ar"></a-animation>
            </a-plane>

            <a-entity id="interactive-elements" position="0 0 0.1" visible="false">
                <a-entity class="interactive" position="0.5 0.5 0.2"
                    onclick="document.getElementById('video-modal').emit('show-modal');"
                    event-set__mouseenter="scale: 1.15 1.15 1.15; material.color: #00FFFF"
                    event-set__mouseleave="scale: 1 1 1; material.color: #FFFFFF"
                    event-set__touchstart="scale: 1.15 1.15 1.15; material.color: #00FFFF"
                    event-set__touchend="scale: 1 1 1; material.color: #FFFFFF">
                    <a-plane height="0.4" width="0.4" material="src: https://lessa2332.github.io/my-ar-vizytka/assets/icons/play.png; transparent: true; alphaTest: 0.1"></a-plane>
                    <a-text value="–í—ñ–¥–µ–æ" align="center" width="1" position="0 -0.3 0" color="#fff" font="exo2bold"></a-text>
                </a-entity>
                
                <a-entity class="interactive" position="-0.5 0.5 0.2"
                    onclick="document.getElementById('game-modal').emit('show-modal');"
                    event-set__mouseenter="scale: 1.15 1.15 1.15; material.color: #00FFFF"
                    event-set__mouseleave="scale: 1 1 1; material.color: #FFFFFF"
                    event-set__touchstart="scale: 1.15 1.15 1.15; material.color: #00FFFF"
                    event-set__touchend="scale: 1 1 1; material.color: #FFFFFF">
                    <a-plane height="0.4" width="0.4" material="src: https://lessa2332.github.io/my-ar-vizytka/assets/icons/goy.png; transparent: true; alphaTest: 0.1"></a-plane>
                    <a-text value="–ì—Ä–∞" align="center" width="1" position="0 -0.3 0" color="#fff" font="exo2bold"></a-text>
                </a-entity>
                
                <a-entity class="interactive" position="0.5 -0.5 0.2"
                    onclick="document.getElementById('social-modal').emit('show-modal');"
                    event-set__mouseenter="scale: 1.15 1.15 1.15; material.color: #00FFFF"
                    event-set__mouseleave="scale: 1 1 1; material.color: #FFFFFF"
                    event-set__touchstart="scale: 1.15 1.15 1.15; material.color: #00FFFF"
                    event-set__touchend="scale: 1 1 1; material.color: #FFFFFF">
                    <a-plane height="0.4" width="0.4" material="src: https://lessa2332.github.io/my-ar-vizytka/assets/icons/youtube.png; transparent: true; alphaTest: 0.1"></a-plane>
                    <a-text value="–°–æ—Ü–º–µ—Ä–µ–∂—ñ" align="center" width="1" position="0 -0.3 0" color="#fff" font="exo2bold"></a-text>
                </a-entity>
                
                <a-entity class="interactive" position="-0.5 -0.5 0.2"
                    onclick="window.open('https://t.me/+Ck0ua_cmlI84Yjcy', '_blank');"
                    event-set__mouseenter="scale: 1.15 1.15 1.15; material.color: #00FFFF"
                    event-set__mouseleave="scale: 1 1 1; material.color: #FFFFFF"
                    event-set__touchstart="scale: 1.15 1.15 1.15; material.color: #00FFFF"
                    event-set__touchend="scale: 1 1 1; material.color: #FFFFFF">
                    <a-plane height="0.4" width="0.4" material="src: https://lessa2332.github.io/my-ar-vizytka/assets/icons/telegram.png; transparent: true; alphaTest: 0.1"></a-plane>
                    <a-text value="–ü—Ä–∏—î–¥–Ω–∞—Ç–∏—Å—å –¥–æ AR_HUB" align="center" width="1.8" position="0 -0.3 0" color="#fff" font="exo2bold"></a-text>
                </a-entity>
            </a-entity>

            <a-entity id="video-modal" visible="false" position="0 0 0"
                animation__show="property: position; to: 0 0 1; dur: 500; easing: easeOutQuad; startEvents: show-modal"
                animation__hide="property: position; to: 0 0 0; dur: 500; easing: easeOutQuad; startEvents: hide-modal">
                <a-plane position="0 0 0" height="1" width="1.6" rotation="0 0 0" color="#333" opacity="0.95">
                    <a-video src="https://lessa2332.github.io/my-ar-vizytka/assets/video/lesa.mp4" autoplay="true" loop="true" position="0 0 0.001" height="0.8" width="1.4"></a-video>
                    <a-plane class="interactive" position="-0.7 -0.55 0.001" height="0.2" width="0.3" color="#FF4500"
                        event-set__mouseenter="scale: 1.1 1.1 1.1"
                        event-set__mouseleave="scale: 1 1 1"
                        event-set__touchstart="scale: 1.1 1.1 1.1"
                        event-set__touchend="scale: 1 1 1"
                        onclick="document.querySelector('a-video').components.video.video.muted = !document.querySelector('a-video').components.video.video.muted;">
                        <a-text value="–ó–≤—É–∫" align="center" color="#fff" width="1.5" position="0 0 0.01" font="exo2bold"></a-text>
                    </a-plane>
                    <a-plane class="interactive" position="0.7 -0.55 0.001" height="0.2" width="0.3" color="#FF4500"
                        event-set__mouseenter="scale: 1.1 1.1 1.1"
                        event-set__mouseleave="scale: 1 1 1"
                        event-set__touchstart="scale: 1.1 1.1 1.1"
                        event-set__touchend="scale: 1 1 1"
                        onclick="document.getElementById('video-modal').emit('hide-modal');">
                        <a-text value="–ó–∞–∫—Ä–∏—Ç–∏" align="center" color="#fff" width="1.5" position="0 0 0.01" font="exo2bold"></a-text>
                    </a-plane>
                </a-plane>
            </a-entity>

            <a-entity id="game-modal" visible="false" position="0 0 0"
                animation__show="property: position; to: 0 0 1; dur: 500; easing: easeOutQuad; startEvents: show-modal"
                animation__hide="property: position; to: 0 0 0; dur: 500; easing: easeOutQuad; startEvents: hide-modal">
                <a-plane quiz-game height="1.2" width="1.6" position="0 0 0" rotation="0 0 0" material="side: double"></a-plane>
                <a-plane class="interactive" position="0.7 -0.55 0.001" height="0.2" width="0.3" color="#FF4500"
                    event-set__mouseenter="scale: 1.1 1.1 1.1"
                    event-set__mouseleave="scale: 1 1 1"
                    event-set__touchstart="scale: 1.1 1.1 1.1"
                    event-set__touchend="scale: 1 1 1"
                    onclick="document.getElementById('game-modal').emit('hide-modal');">
                    <a-text value="–ó–∞–∫—Ä–∏—Ç–∏" align="center" color="#fff" width="1.5" position="0 0 0.01" font="exo2bold"></a-text>
                </a-plane>
            </a-entity>

            <a-entity id="social-modal" visible="false" position="0 0 0"
                animation__show="property: position; to: 0 0 1; dur: 500; easing: easeOutQuad; startEvents: show-modal"
                animation__hide="property: position; to: 0 0 0; dur: 500; easing: easeOutQuad; startEvents: hide-modal">
                <a-plane position="0 0 0" height="1.2" width="1.6" color="#333" opacity="0.95">
                    <a-text value="üì± –°–æ—Ü–º–µ—Ä–µ–∂—ñ:" align="left" color="#fff" width="1.5" position="-0.7 0.45 0.01" font="exo2bold"></a-text>
                    <a-plane class="interactive" position="-0.4 0.25 0.01" height="0.2" width="1" 
                        material="src: https://lessa2332.github.io/my-ar-vizytka/assets/icons/youtube.png; transparent: true; alphaTest: 0.1"
                        event-set__mouseenter="scale: 1.05 1.05 1.05"
                        event-set__mouseleave="scale: 1 1 1"
                        event-set__touchstart="scale: 1.05 1.05 1.05"
                        event-set__touchend="scale: 1 1 1"
                        onclick="window.open('https://www.youtube.com/@23SmartLessa32', '_blank');">
                    </a-plane>
                    <a-plane class="interactive" position="-0.4 -0.15 0.01" height="0.2" width="1" 
                        material="src: https://lessa2332.github.io/my-ar-vizytka/assets/icons/googlesites.png; transparent: true; alphaTest: 0.1"
                        event-set__mouseenter="scale: 1.05 1.05 1.05"
                        event-set__mouseleave="scale: 1 1 1"
                        event-set__touchstart="scale: 1.05 1.05 1.05"
                        event-set__touchend="scale: 1 1 1"
                        onclick="window.open('https://sites.google.com/view/questaria/%D0%B3%D0%BE%D0%BB%D0%BE%D0%B2%D0%BD%D0%B0', '_blank');">
                    </a-plane>
                    <a-plane class="interactive" position="-0.4 -0.35 0.01" height="0.2" width="1" 
                        material="src: https://lessa2332.github.io/my-ar-vizytka/assets/icons/instagram.png; transparent: true; alphaTest: 0.1"
                        event-set__mouseenter="scale: 1.05 1.05 1.05"
                        event-set__mouseleave="scale: 1 1 1"
                        event-set__touchstart="scale: 1.05 1.05 1.05"
                        event-set__touchend="scale: 1 1 1"
                        onclick="window.open('https://www.instagram.com/smart23lessa?igsh=aHN5dzZudnJneW85', '_blank');">
                    </a-plane>
                    <a-plane class="interactive" position="0.7 -0.55 0.001" height="0.2" width="0.3" color="#FF4500"
                        event-set__mouseenter="scale: 1.1 1.1 1.1"
                        event-set__mouseleave="scale: 1 1 1"
                        event-set__touchstart="scale: 1.1 1.1 1.1"
                        event-set__touchend="scale: 1 1 1"
                        onclick="document.getElementById('social-modal').emit('hide-modal');">
                        <a-text value="–ó–∞–∫—Ä–∏—Ç–∏" align="center" color="#fff" width="1.5" position="0 0 0.01" font="exo2bold"></a-text>
                    </a-plane>
                </a-plane>
            </a-entity>
        </a-entity>
    </a-scene>

    <script>
        const loader = document.querySelector('#loader');
        const targetEntity = document.querySelector('[mindar-image-target]');
        const mainPhotoPlane = document.querySelector('#main-photo-plane');
        const interactiveElements = document.querySelector('#interactive-elements');
        const portal = document.querySelector('#portal');
        const videoModal = document.querySelector('#video-modal');
        const gameModal = document.querySelector('#game-modal');
        const socialModal = document.querySelector('#social-modal');

        // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ WebXR
        if (!navigator.xr) {
            loader.textContent = '–ü–æ–º–∏–ª–∫–∞: –í–∞—à –ø—Ä–∏—Å—Ç—Ä—ñ–π –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î AR';
            console.error('WebXR –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è');
            return;
        }

        // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –º–∞—Ä–∫–µ—Ä–∞
        fetch('https://lessa2332.github.io/my-ar-vizytka/assets/targets/mycard.mind')
            .then(response => {
                if (!response.ok) throw new Error('–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –º–∞—Ä–∫–µ—Ä');
            })
            .catch(() => {
                loader.textContent = '–ü–æ–º–∏–ª–∫–∞: –ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –º–∞—Ä–∫–µ—Ä';
                console.error('–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ .mind —Ñ–∞–π–ª');
            });

        // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —ñ–Ω—à–∏—Ö —Ä–µ—Å—É—Ä—Å—ñ–≤
        const resources = [
            'https://lessa2332.github.io/my-ar-vizytka/assets/images/photo.jpg',
            'https://lessa2332.github.io/my-ar-vizytka/assets/icons/play.png',
            'https://lessa2332.github.io/my-ar-vizytka/assets/icons/goy.png',
            'https://lessa2332.github.io/my-ar-vizytka/assets/icons/youtube.png',
            'https://lessa2332.github.io/my-ar-vizytka/assets/icons/telegram.png',
            'https://lessa2332.github.io/my-ar-vizytka/assets/video/lesa.mp4'
        ];
        resources.forEach(url => {
            fetch(url)
                .then(response => {
                    if (!response.ok) throw new Error(`–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ ${url}`);
                })
                .catch(() => {
                    console.error(`–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ä–µ—Å—É—Ä—Å—É: ${url}`);
                });
        });

        // –û–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫ AR
        const scene = document.querySelector('a-scene');
        scene.addEventListener('arError', () => {
            loader.textContent = '–ü–æ–º–∏–ª–∫–∞: –ù–µ –≤–¥–∞–ª–æ—Å—è —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ AR';
            console.error('–ü–æ–º–∏–ª–∫–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó AR');
        });

        targetEntity.addEventListener('targetFound', () => {
            console.log('‚úÖ –ú–∞—Ä–∫–µ—Ä –∑–Ω–∞–π–¥–µ–Ω–æ!');
            loader.style.display = 'none';
            mainPhotoPlane.setAttribute('visible', 'true');
            portal.setAttribute('visible', 'true');
            interactiveElements.setAttribute('visible', 'true');
            mainPhotoPlane.emit('start-ar');
            portal.emit('start-ar');
            portal.emit('pulse-ar');
            console.log('–°—Ç–∞–Ω –µ–ª–µ–º–µ–Ω—Ç—ñ–≤:', {
                mainPhotoPlane: mainPhotoPlane.getAttribute('visible'),
                portal: portal.getAttribute('visible'),
                interactiveElements: interactiveElements.getAttribute('visible')
            });
        });

        targetEntity.addEventListener('targetLost', () => {
            console.log('‚ùå –ú–∞—Ä–∫–µ—Ä –≤—Ç—Ä–∞—á–µ–Ω–æ!');
            loader.style.display = 'flex';
            mainPhotoPlane.setAttribute('visible', 'false');
            portal.setAttribute('visible', 'false');
            interactiveElements.setAttribute('visible', 'false');
            videoModal.setAttribute('visible', 'false');
            gameModal.setAttribute('visible', 'false');
            socialModal.setAttribute('visible', 'false');
        });

        videoModal.addEventListener('hide-modal', () => {
            const videoEl = document.querySelector('a-video');
            if (videoEl && videoEl.components.video.video) {
                videoEl.components.video.video.pause();
                videoEl.components.video.video.currentTime = 0;
            }
        });
    </script>
</body>
</html>
